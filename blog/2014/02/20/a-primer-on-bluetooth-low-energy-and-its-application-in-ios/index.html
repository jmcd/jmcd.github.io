
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>A Primer on Bluetooth Low Energy, and It&#8217;s Application in iOS - jmcd.io</title>
  <meta name="author" content="John McDowall">

  
  <meta name="description" content="What is it? Bluetooth Low Energy (BLE) is a technology for allowing devices to communicate in a way that is highly optimized for conserving battery &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jmcd.io/blog/2014/02/20/a-primer-on-bluetooth-low-energy-and-its-application-in-ios/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="jmcd.io" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">jmcd.io</a></h1>
  
    <h2>John McDowall</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://www.duckduckgo.com/" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="jmcd.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">A Primer on Bluetooth Low Energy, and It&#8217;s Application in iOS</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-02-20T00:00:00+00:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><h2>What is it?</h2>

<p>Bluetooth Low Energy (BLE) is a technology for allowing devices to communicate in a way that is highly optimized for conserving battery power.</p>

<p>BLE devices include things like FitBit trackers, heart-rate monitors, set-top-boxes, and fancy thermostats. The Internet of things. Very exciting possibilities!</p>

<p>BLE defined in the Bluetooth 4.0 specification, and is not compatible with older Bluetooth architectures.</p>

<p>BLE has far lower bit-rates than older technologies, and different radio setup. This means much better battery life for devices.</p>

<h2>The central and the peripheral</h2>

<p>When a BLE is connected to the other, one is termed the peripheral, the other is termed the central. The central is the consumer of data from the peripheral. For example, when you connect your iPhone to your FitBit, the iPhone is the central and the FitBit is the peripheral.</p>

<p>A central may have many peripherals, but a peripheral may (normally) only have one central.</p>

<p>The BLE device (e.g. FitBit) continually broadcasts advertisement packets. When another device (e.g. iPhone) wants to make a connection, it scans for these advertisement packets. Once an advertisement packet is discovered, a connection request is sent to the broadcaster. The broadcaster accepts the connection request, and the pair are peripheral and central.</p>

<h2>Services and characteristics</h2>

<p>Communication between connected central and peripheral takes place by reading and writing of characteristic values exposed by the peripheral. Characteristics are grouped into services. Services and characteristics are identified by unique identifiers. Characteristic values are 16 bytes long.</p>

<p><img src="/img/blutoot.png" title="hierarchy of device" ></p>

<p>A central can directly read the value of a characteristic, or it can register with the peripheral to receive updates when the value changes.</p>

<h2>iOS and CoreBluetooth</h2>

<p>The iOS SDK abstracts the complexities of BLE workings with the CoreBluetooth framework. The main players:</p>

<ul>
<li>CBCentralManager - discovers and connects to peripherals</li>
<li>CBPeripheral - represents a peripheral, discovers services, discovers characteristics</li>
<li>CBService - represents a service of a peripheral</li>
<li>CBCharacteristic - represents a characteristic of a service</li>
</ul>


<p>Discovery of peripherals, services, and characteristics all happen through asynchronous operations. Completions are signaled via callbacks on delegate implementations.</p>

<h2>An basic example</h2>

<p>In this example we will discover a fictional thermostat, and through a service:</p>

<ol>
<li>set the threshold temperature</li>
<li>ask to be notified of changes in the ambient temperature</li>
</ol>


<p>Discovery of peripherals is done by implementing CBCentralManagerDelegate, then scanning with a CBCentralManager. Before attempting to connect to a device, work out if you should, either by UUID, name, or user selection.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">discoverPerhiperals</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'> <span class="bp">CBCentralManager</span> <span class="o">*</span><span class="n">central</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">CBCentralManager</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithDelegate</span><span class="p">:</span><span class="nb">self</span> <span class="nl">queue</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'> <span class="p">[</span><span class="nb">self</span> <span class="nl">scan</span><span class="p">:</span><span class="n">central</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'> <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - CBCentralManagerDelegate</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">centralManager:</span><span class="p">(</span><span class="bp">CBCentralManager</span> <span class="o">*</span><span class="p">)</span><span class="nv">central</span> <span class="nf">didDiscoverPeripheral:</span><span class="p">(</span><span class="bp">CBPeripheral</span> <span class="o">*</span><span class="p">)</span><span class="nv">peripheral</span> <span class="nf">advertisementData:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">advertisementData</span> <span class="nf">RSSI:</span><span class="p">(</span><span class="bp">NSNumber</span> <span class="o">*</span><span class="p">)</span><span class="nv">RSSI</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'> <span class="kt">BOOL</span> <span class="n">shouldConnect</span> <span class="o">=</span> <span class="cm">/* your code to determine if you should try to connect to this device */</span>
</span><span class='line'>
</span><span class='line'> <span class="k">if</span> <span class="p">(</span><span class="n">shouldConnect</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="p">[</span><span class="n">central</span> <span class="n">stopScan</span><span class="p">];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">central</span> <span class="nl">connectPeripheral</span><span class="p">:</span><span class="n">peripheral</span> <span class="nl">options</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">centralManager:</span><span class="p">(</span><span class="bp">CBCentralManager</span> <span class="o">*</span><span class="p">)</span><span class="nv">central</span> <span class="nf">didConnectPeripheral:</span><span class="p">(</span><span class="bp">CBPeripheral</span> <span class="o">*</span><span class="p">)</span><span class="nv">peripheral</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'> <span class="p">[</span><span class="nb">self</span> <span class="nl">discoverServicesForPeripheral</span><span class="p">:</span><span class="n">peripheral</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once you are connected to a perhiperal, you can discover its services. You can discover services by UUID, or discover all the services a perhiperal hosts. Typically you will want to discover one or two well known services by id. - this is faster than discovering all services.</p>

<p>BLE UUIDs are 128 bit and have the form 0000nnnn-0000-1000-8000-00805f9b34fb, often you will see them abbreviated to 0xnnnn. (See page 216 of the  <a href="https://www.bluetooth.org/docman/handlers/downloaddoc.ashx?doc_id=229737">Bluetooth Specification V4.0 [Vol3]</a>)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">{</span>
</span><span class='line'> <span class="n">_thermostatServiceUuid</span> <span class="o">=</span> <span class="p">[</span><span class="bp">CBUUID</span> <span class="nl">UUIDWithString</span><span class="p">:</span><span class="s">@&quot;0000nnnn-0000-1000-8000-00805f9b34fb&quot;</span><span class="p">];</span>
</span><span class='line'> <span class="n">_heatingTurnsOnTemperatureCharacteristicUuid</span> <span class="o">=</span> <span class="bp">CBUUID</span> <span class="nl">UUIDWithString</span><span class="p">:</span><span class="s">@&quot;0000nnnn-0000-1000-8000-00805f9b34fb&quot;</span><span class="p">];</span>
</span><span class='line'> <span class="n">_currentAmbientTemperatureCharacteristicUuid</span> <span class="o">=</span> <span class="bp">CBUUID</span> <span class="nl">UUIDWithString</span><span class="p">:</span><span class="s">@&quot;0000nnnn-0000-1000-8000-00805f9b34fb&quot;</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">discoverServicesForPerhiperal</span><span class="p">:(</span><span class="bp">CBPeripheral</span><span class="o">*</span><span class="p">)</span><span class="n">peripheral</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'> <span class="n">peripheral</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span>
</span><span class='line'> <span class="p">[</span><span class="n">peripheral</span> <span class="nl">discoverServices</span><span class="p">:</span><span class="l">@[</span><span class="n">_thermostatServiceUuid</span><span class="l">]</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - CBPeripheralDelegate</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">peripheral</span><span class="p">:(</span><span class="bp">CBPeripheral</span> <span class="o">*</span><span class="p">)</span><span class="n">peripheral</span> <span class="nl">didDiscoverServices</span><span class="p">:(</span><span class="bp">NSError</span> <span class="o">*</span><span class="p">)</span><span class="n">error</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'> <span class="bp">CBService</span> <span class="o">*</span><span class="n">service</span> <span class="o">=</span> <span class="n">peripheral</span><span class="p">.</span><span class="n">services</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'> <span class="p">[</span><span class="n">peripheral</span> <span class="nl">discoverCharacteristics</span><span class="p">:</span><span class="l">@[</span><span class="n">_heatingTurnsOnTemperatureCharacteristicUuid</span><span class="p">,</span> <span class="n">_currentAmbientTemperatureCharacteristicUuid</span><span class="l">]</span> <span class="nl">forService</span><span class="p">:</span><span class="n">service</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">peripheral</span><span class="p">:(</span><span class="bp">CBPeripheral</span> <span class="o">*</span><span class="p">)</span><span class="n">peripheral</span> <span class="nl">didDiscoverCharacteristicsForService</span><span class="p">:(</span><span class="bp">CBService</span> <span class="o">*</span><span class="p">)</span><span class="n">service</span> <span class="nl">error</span><span class="p">:(</span><span class="bp">NSError</span> <span class="o">*</span><span class="p">)</span><span class="n">error</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'> <span class="k">for</span> <span class="p">(</span><span class="bp">CBCharacteristic</span> <span class="o">*</span><span class="n">characteristic</span> <span class="k">in</span> <span class="n">service</span><span class="p">.</span><span class="n">characteristics</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">([</span><span class="n">characteristic</span><span class="p">.</span><span class="n">UUID</span> <span class="nl">isEqual</span><span class="p">:</span><span class="n">_heatingTurnsOnTemperatureCharacteristicUuid</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>   <span class="c1">// Change the temperature at which the heating turns on</span>
</span><span class='line'>   <span class="bp">NSData</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="cm">/* encode 16 bytes of data */</span>
</span><span class='line'>   <span class="p">[</span><span class="n">_peripheral</span> <span class="nl">writeValue</span><span class="p">:</span><span class="n">data</span> <span class="nl">forCharacteristic</span><span class="p">:</span><span class="n">characteristic</span> <span class="nl">type</span><span class="p">:</span><span class="n">CBCharacteristicWriteWithResponse</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">([</span><span class="n">characteristic</span><span class="p">.</span><span class="n">UUID</span> <span class="nl">isEqual</span><span class="p">:</span><span class="n">_currentAmbientTemperatureCharacteristicUuid</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>   <span class="c1">// Register to receive notifications of changes to ambient temperature</span>
</span><span class='line'>   <span class="p">[</span><span class="n">peripheral</span> <span class="nl">setNotifyValue</span><span class="p">:</span><span class="nb">YES</span> <span class="nl">forCharacteristic</span><span class="p">:</span><span class="n">characteristic</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">peripheral</span><span class="p">:(</span><span class="bp">CBPeripheral</span> <span class="o">*</span><span class="p">)</span><span class="n">peripheral</span> <span class="nl">didUpdateValueForCharacteristic</span><span class="p">:(</span><span class="bp">CBCharacteristic</span> <span class="o">*</span><span class="p">)</span><span class="n">characteristic</span> <span class="nl">error</span><span class="p">:(</span><span class="bp">NSError</span> <span class="o">*</span><span class="p">)</span><span class="n">error</span> <span class="p">{</span>
</span><span class='line'> <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;didUpdateValueForCharacteristic&quot;</span><span class="p">);</span>
</span><span class='line'> <span class="k">if</span> <span class="p">([</span><span class="n">characteristic</span><span class="p">.</span><span class="n">UUID</span> <span class="nl">isEqual</span><span class="p">:</span><span class="n">_currentAmbientTemperatureCharacteristicUuid</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="bp">NSData</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">characteristic</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
</span><span class='line'>  <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;The current temperature is @%&quot;</span><span class="p">,</span> <span class="cm">/* decode 16 bytes of data */</span><span class="p">)</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">John McDowall</span></span>

      




<time class='entry-date' datetime='2014-02-20T00:00:00+00:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>12:00 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/ble/'>ble</a>, <a class='category' href='/blog/categories/bluetooth/'>bluetooth</a>, <a class='category' href='/blog/categories/corebluetooth/'>corebluetooth</a>, <a class='category' href='/blog/categories/ios/'>ios</a>, <a class='category' href='/blog/categories/objective-c/'>objective-c</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://jmcd.io/blog/2014/02/20/a-primer-on-bluetooth-low-energy-and-its-application-in-ios/" data-via="" data-counturl="http://jmcd.io/blog/2014/02/20/a-primer-on-bluetooth-low-energy-and-its-application-in-ios/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/09/18/my-two-favourite-parts-of-the-ios7-sdk/" title="Previous Post: My two favourite parts of the iOS 7 SDK">&laquo; My two favourite parts of the iOS 7 SDK</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/03/18/method-access-modifiers-as-code-smells/" title="Next Post: Method access modifiers as code smells">Method access modifiers as code smells &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/03/18/method-access-modifiers-as-code-smells/">Method Access Modifiers as Code Smells</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/20/a-primer-on-bluetooth-low-energy-and-its-application-in-ios/">A Primer on Bluetooth Low Energy, and It&#8217;s Application in iOS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/18/my-two-favourite-parts-of-the-ios7-sdk/">My Two Favourite Parts of the iOS 7 SDK</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/10/handling-annotation-pins-on-the-same-coordinate/">Handling MKMapView Annotation Pins on the Same Coordinate</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/07/stop-it-nintendo-no-you're-hurting-me/">Stop It Nintendo, No, You&#8217;re Hurting Me</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - John McDowall -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
